# HERD量能器三维信息重建



1. HERD简介
   1. HERD科学目标
   2. HERD有效载荷
2. 量能器分类及其相互左右
   1. 电磁簇射
   2. 强子簇射
3. HERD量能器三维信息重建算法
   	1. 例子入射方向及其角度分辨率
   	1. 粒子入射能量及其能量分辨率
   	1. 多变量粒子鉴别

## HERD简介

​	⾼能宇宙辐射探测设施 (the High Energy cosmic-Radiation Detection facility, HERD) 是由中科院⾼能物理研究所主导的的⼤型国际合作空间科学实验，计划于2027年发射并搭载于中国空间站。

### HERD科学目标

	* 以前所未有的灵敏度搜寻暗物质
	* 探究宇宙线起源的世纪之谜
	* 开展最高灵敏度的高能伽玛射线巡天

### HERD有效载荷

 * 三维成像量能器（CALO）
 * 闪烁光纤径迹仪（FIT）
 * 塑闪反符合探测器（PSD）
 * 硅电荷探测器（SCD）
 * 穿越辐射探测器（TRD）

![图片](D:\picture\herd.png)

<center><p>图（1）：HERD概念图</p></center>

 HERD关键的组成部分是其中心的量能器。量能器的基本任务是精确测量粒⼦的能量，待测粒⼦穿过量能器物质通过各种相互作⽤将它的全部或部分能量沉积在该物质中，其中⼤部分转化为热能，另⼀部分转化为与沉积能量成正⽐的可测量信号，⼀般为闪烁体的闪烁光或者半导体的电离信号，被光电转换器件和电荷收集器件读出。对能量⼤于 1 GeV 的电⼦、光⼦，在⾜够厚的物质中会发⽣电磁簇射，⽽对能量⼤于 5 GeV 的核⼦通常会发⽣强⼦簇射。

量能器 CALO 由约 7500 块硅酸钇镥（LYSO）立方晶体块组成的阵列构成。每块晶体耦合两根波长转移光纤，做双端引出，共计四路输出。其中两路送至高低量程增强相机做幅度输出，另两路作为触发光纤送至触发系统。单块晶体输出的光纤信号在增强相机中由数百个像素收集，完成强度测量。两台增强相机量程互相搭接，共同完成近 10^6总动态范围的能量测量。

![](D:\picture\calo1.png)

<center><p>图（2）：CALO概念图</p></center>

​                                                                                                               



## 量能器分类及其相互作用

### 电磁簇射

⾼能电⼦、光⼦在物质中的电磁相互作用主要表现为韧致辐射和电⼦对产⽣，两种作用交替发⽣使次级粒⼦随着⼊射深度增加级联产⽣，直到它们的能量减少到临界能量 (E~c~) 时为⽌，这个过程称为电磁簇射。为了描述⾼能电⼦和光⼦的簇射⾏为，引⼊度量 介质材料厚度的单位：辐射长度 X~0~，即电⼦由于韧致辐射损失能量直至平均能量较小到远处能量的 1/e 时所穿过的介质的平均厚度，X~0~与介质原⼦的原子序数和原⼦量有关。

* **平均纵向发展**

$$
\frac{dE}{dt} = E_0b\frac{bt^{a-1}e^{-bt}}{\Gamma(a)} \tag{1}
$$


$$
t_{max} = \frac{a-1}{b} = \ln\frac{E_0}{E_c} + t_0 \tag{2}
$$



$$
t_{95\%} = t_{max} + 0.08Z + 9.6 \tag{3}
$$




* **平均横向发展**

$$
R_M(g/cm^2) = 21MeV\frac{X_0}{E_c(MeV)} \tag{4}
$$




$$
f(r) = \frac{1}{dE(t)}\frac{dE(t,r)}{dr} = p\frac{2r{R_c}^2}{r^2+{R_c}^2}+(1-p)\frac{2r{R_t}^2}{r^2+{R_t}^2} \tag{5}
$$




* **能量分辨率**

$$
\frac{\sigma}{E}=\frac aE\oplus\frac{b}{\sqrt[2]{E}}\oplus c \tag{6}
$$

### 强子簇射

⾼能强⼦通过介质时与介质原⼦核发⽣强相互作⽤，其中⾮弹性相互作⽤产⽣多个次级强⼦，⽽次级强⼦又在介质中发⽣新的相互作⽤，产⽣更多的次级粒⼦，称为强⼦簇射。次级粒⼦⼤部分是核⼦和 $\pi$ 介质，其中$\pi$~0~衰变为⼀对光⼦，在介质中产⽣电磁簇射。次级带电$\pi$衰变成$\mu$和$\nu_\mu~$， 其中$\mu$通过电离损失能量，⽽$\nu_\mu$不发⽣相互作⽤直接穿过介质。强⼦簇射中有⼀部分能量不可观测，包括簇射发展过程中产⽣的中微⼦、逃逸的$\mu$⼦、核场中释放核⼦的结合能，有相当⼀部分能量被核蒸发产⽣的软中⼦带⾛，⽽中⼦对量能器信号的贡献与介质类型 (例如富氢物质能够有效地慢化中⼦) 和读出电⼦学设计有关。⼀般来说，强⼦簇射的不可观测能量可占⾮电磁沉积能量的 40%。强⼦簇射的发展由核相互作⽤长度 ($\lambda_L$) 描述： $\lambda_L = 35g·{cm}^{-2}·A^{1/3}$.

* **纵向发展**

$$
t_{max}(\lambda_L)\approx0.2\ln E(GeV)+0.7 \tag{7}
$$




$$
t_{95\%} \approx t_{max} + 2.5\lambda_L{[E(GeV)]}^{0.13} \tag{8}
$$




* **横向发展**

$$
R_{95\%}(\lambda_L) \approx 1 \tag{9}
$$





* **能量分辨率**

$$
\frac{\sigma}{E} = \sqrt[]{\frac{({\sigma_{int}}^2 + {\sigma_{samp}}^2)}{E}} + a \tag{10}
$$





## HERD量能器三维信息算法

### 粒子入射方向及其角度分辨率

- **重心法（COG）**

根据电磁簇射横向发展规律，采取重心法重建每一层的簇射中心
$$
x_c = \frac{\sum_i^n x_i · \sqrt{E_i}}{\sum_i^n \sqrt{E_i}} \tag{11}
$$

$$
y_c = \frac{\sum_i^n y_i · \sqrt{E_i}}{\sum_i^n \sqrt{E_i}} \tag{12}
$$


得到各层重心后，分别在XZ和YZ平面线性拟合得到粒子在量能器的迳迹，可以分别得到斜率k~x~和k~Y~。则粒子的入射角度可以表示为

$\theta = arctan \sqrt{k_x^2 +k_y^2}$，即粒子入射方向和量能器Z轴的夹角。



重建角度与入射角度的夹角可以表示为：$\Delta\theta = arctan \sqrt{(k_x - \overline k_x)^2 + (k_y - \overline k_y)^2}$，定义角分辨率$\Delta\theta_{68}$,$\Delta\theta$分布中小于68%总事例数的阈值。



- **主成分分析法（PCA）**

宇宙线粒子穿过量能器的时候，大多数粒子在量能器中会发生簇射过程，其簇射形态在纵向和横向的分布可以用公式（1）-（5）和（7）-（9）来描述，大致形态如下图（3）所示。粒子在纵向穿过的同时会由于库伦作用而发生横向的偏移，通过量能器各晶体沉积的能量信息并且结合各晶体的位置，运用PCA可以找到簇射的主轴，即簇射纵向方向。



<img src="D:\picture\geo.PCA.png" style="zoom: 50%;" />

<center><p>图（3）：PCA簇射主轴</p></center>

主成分分析法是一种使用广泛的数据降维算法，其主要思想是将n维特征映射到k（k<=n）维上，将一组可能存在相关性的变量转化为一组不相关的变量。对应与粒子在量能器中的簇射信息，就是找到让数据点能够尽量散开的投影方向，也就是投影前后数据损失最小的方向，即原始数据中方差最大的方向，这个方向称为第一主方向，也就是簇射的主轴纵轴，数据投影到主方向的部分称为第一主成分。第二第三主方向选取为与第一个主方向正交的平面中原始数据投影后方差第二大第三大的坐标轴，也就是簇射的横向方向。





通过粒子在三维量能器中的击中信息，得到击中着火晶体的坐标（x~ir~,y~ir~,z~ir~）和其沉积的能量大小E~i~，其中i$\in$[0,n]，n为着火晶体总数。通过重心法求得簇射的中心坐标（x~0~,y~0~,z~0~），得到晶体坐标相对于簇射中心的坐标（x~i0~,y~i0~,z~i0~）。



针对击中晶体的样本数量n，得到了一个3*n的样本数据矩阵R：
$$
\begin{pmatrix}
x_{10} & x_{20} & x_{30} & \cdots & x_{n0} \\
y_{10} & y_{20} & y_{30} & \cdots & y_{n0} \\
z_{10} & z_{20} & z_{30} & \cdots & z_{n0} \\
\end{pmatrix}
$$


求此3个特征向量的协方差矩阵C，协方差的定义式为：$Cov(X,Y) = \frac{1}{n-1} \sum_1^n(x_i - \overline x)(y_i - \overline y)$。为了求其协方差矩阵，我们先对样本数据A进行零均值化处理，即对X,Y,Z三个特征变量，每一个变量都减去它们各自的均值$\mu$。经过零均值处理后，特征变量X,Y,Z的平均值都变为了0，然而，由于数据的离散程度并没有发生变化，所以并不会改变方差和协方差的值。并且，从协方差公式也可以看的很清楚。



从原始数据矩阵*R*到相对簇射中心数据矩阵*RO*到零均值化数据矩阵*A*:

$\begin{pmatrix} x_{1r}&x_{2r}&x_{3r}&\cdots&x_{nr}\\y_{1r}&y_{2r}&y_{3r}&\cdots&y_{nr}\\z_{1r}&z_{2r}&z_{3r}&\cdots&z_{nr}\end{pmatrix} \Rightarrow \begin{pmatrix} x_{10} & x_{20} & x_{30} & \cdots & x_{n0} \\y_{10} & y_{20} & y_{30} & \cdots & y_{n0} \\z_{10} & z_{20} & z_{30} & \cdots & z_{n0} \end{pmatrix} \Rightarrow \begin{pmatrix} x_{1} & x_{2} & x_{3} & \cdots & x_{n} \\y_{1} & y_{2} & y_{3} & \cdots & y_{n} \\z_{1} & z_{2} & z_{3} & \cdots & z_{n} \end{pmatrix}$ 



对于处理后的数据，X,Y,Z三个特征向量的协方差矩阵如下：

$\begin{pmatrix} Cov(X,X)&Cov(X,Y)&Cov(X,Z)\\Cov(Y,X)&Cov(Y,Y)&Cov(Y,Z)\\Cov(Z,X)&Cov(Z,Y)&Cov(Z,Z)\end{pmatrix}$ = $\begin{pmatrix} \frac{1}{n-1} \sum_1^n x_i^2&\frac{1}{n-1} \sum_1^n x_iy_i&\frac{1}{n-1} \sum_1^n x_iz_i\\\frac{1}{n-1} \sum_1^n y_ix_i&\frac{1}{n-1} \sum_1^n y_i^2&\frac{1}{n-1} \sum_1^n y_iz_i\\\frac{1}{n-1} \sum_1^n z_ix_i&\frac{1}{n-1} \sum_i^n z_iy_i&\frac{1}{n-1} \sum_1^n z_i^2 \end{pmatrix}$ = $\frac{1}{n-1}\begin{pmatrix}  \sum_1^n x_i^2& \sum_1^n x_iy_i& \sum_1^n x_iz_i\\ \sum_1^n y_ix_i& \sum_1^n y_i^2& \sum_1^n y_iz_i\\ \sum_1^n z_ix_i& \sum_i^n z_iy_i& \sum_1^n z_i^2\end{pmatrix}$





而矩阵$\begin{pmatrix}  \sum_1^n x_i^2& \sum_1^n x_iy_i& \sum_1^n x_iz_i\\ \sum_1^n y_ix_i& \sum_1^n y_i^2& \sum_1^n y_iz_i\\ \sum_1^n z_ix_i& \sum_i^n z_iy_i& \sum_1^n z_i^2\end{pmatrix}$就是经过零均值化后的样本数据矩阵$A = \begin{pmatrix} x_{1} & x_{2} & x_{3} & \cdots & x_{n} \\y_{1} & y_{2} & y_{3} & \cdots & y_{n} \\z_{1} & z_{2} & z_{3} & \cdots & z_{n} \end{pmatrix}$与自身转置矩阵$A^T$乘积的结果，即$C = AA^T = \begin{pmatrix} x_{1} & x_{2} & x_{3} & \cdots & x_{n} \\y_{1} & y_{2} & y_{3} & \cdots & y_{n} \\z_{1} & z_{2} & z_{3} & \cdots & z_{n} \end{pmatrix} \begin{pmatrix} x_{1} & y_{1} & z_{1}\\x_{2} & y_{2} & z_{2}\\x_{3} & y_{3} & z_{3} \\\vdots&\vdots&\vdots\\x_n&y_n&z_n \end{pmatrix}$，一般来说，X,Y和Z是线性无关的特征向量，那么协方差矩阵C就是对称，正定的满秩矩阵。



为了寻找簇射主轴，我们要用一组新的基底来表示样本特征X,Y和Z向量，并且要求在新的基底下表示的新的特征向量彼此无关。在此，我们新选择三个正交基$P_1\begin{pmatrix}P_{11}\\P_{12}\\P_{13}\end{pmatrix},P_2\begin{pmatrix}P_{21}\\P_{22}\\P_{23}\end{pmatrix},P_3\begin{pmatrix}P_{31}\\P_{32}\\P_{33}\end{pmatrix}$，正交基所构成的矩阵$P$可表示为：$\begin{pmatrix} P_1^T\\P_2^T\\P_3^T\end{pmatrix}$。由于在新的基底下表示的特征向量线性无关，所以新特征向量的协方差矩阵应该是对角矩阵，即$C_{NEW} = PA{(PA)}^T = PAA^TP^T = PCP^T$为对角矩阵，根据线性代数知识：实对称矩阵的特征值一定是实数，而且一定能够对角化，可知矩阵$P$一定存在，并且$P_1,P_2,P_3$就是实对称矩阵$C$的三个特征向量。



综上可以得出，PCA的主要过程就是求得协方差矩阵C的特征值和特征向量，在选取作为主成分的时候，在新特征向量上数据方差最大对应着特征值绝对值越大，此时第一主成分包含的信息也就越多。特征值绝对值最大的特征向量就是第一主方向，也就是我们要找的簇射主轴纵向方向。



***采用$(X,Y,Z,E)$四个特征变量进行处理***



### 粒子入射能量及能量分辨率



根据得到的簇射主轴，根据公式（1）和（5）对主轴方向及横向的每层晶体进行积分，求得积分后能量与实际沉积能量的差值，通过最优化簇射发展纵向分布的概率密度函数的参数，使得差值最小，从而得到入射能量参数。



- 簇射横向泄露



### 多变量粒子鉴别



- TMVA









